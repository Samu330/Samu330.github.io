<!DOCTYPE html>
<html>
<head>
    <title>Tetris</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
        }
        
        #tetris {
            display: flex;
            flex-direction: row;
        }
        
        .block {
            width: 30px;
            height: 30px;
            background-color: grey;
        }
    </style>
</head>
<body>
    <div id="tetris"></div>
    <script>
        const tetrisGrid = [];
        const rows = 20;
        const columns = 10;
        
        for (let i = 0; i < rows; i++) {
            tetrisGrid.push(new Array(columns).fill(0));
        }
        
        function createGrid() {
            const tetrisContainer = document.getElementById('tetris');
        
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < columns; j++) {
                    const block = document.createElement('div');
                    block.className = 'block';
                    if (tetrisGrid[i][j] === 1) {
                        block.style.backgroundColor = 'cyan';
                    }
                    tetrisContainer.appendChild(block);
                }
            }
        }
        
        function drawGrid() {
            const tetrisContainer = document.getElementById('tetris');
            tetrisContainer.innerHTML = '';
        
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < columns; j++) {
                    const block = document.createElement('div');
                    block.className = 'block';
                    if (tetrisGrid[i][j] === 1) {
                        block.style.backgroundColor = 'cyan';
                    }
                    tetrisContainer.appendChild(block);
                }
            }
        }
        
        function rotateTetromino(tetromino) {
            const rotatedTetromino = [];
            const N = tetromino.length - 1;
        
            for (let row = 0; row < tetromino.length; row++) {
                const newRow = tetromino.map((_, i) => tetromino[N - i][row]);
                rotatedTetromino.push(newRow);
            }
        
            return rotatedTetromino;
        }
        
        function isCollision(tetromino, startX, startY) {
            for (let row = 0; row < tetromino.length; row++) {
                for (let col = 0; col < tetromino[row].length; col++) {
                    if (tetromino[row][col] && (tetrisGrid[row + startY] && tetrisGrid[row + startY][col + startX]) !== 0) {
                        return true;
                    }
                }
            }
        
            return false;
        }
        
        function mergeTetromino(tetromino, startX, startY) {
            tetromino.forEach((row, rowIdx) => {
                row.forEach((cell, colIdx) => {
                    if (cell) {
                        tetrisGrid[rowIdx + startY][colIdx + startX] = cell;
                    }
                });
            });
        }
        
        function removeRow(rowIdx) {
            tetrisGrid.splice(rowIdx, 1);
            tetrisGrid.unshift(new Array(columns).fill(0));
        }
        
        function clearRows() {
            let fullRows = [];
        
            tetrisGrid.forEach((row, rowIdx) => {
                if (row.every(cell => cell)) {
                    fullRows.push(rowIdx);
                }
            });
        
            fullRows.forEach(rowIdx => {
                removeRow(rowIdx);
            });
        }
        
        function moveDown(currentTetromino, startX, startY) {
            const newStartY = startY + 1;
        
            if (!isCollision(currentTetromino, startX, newStartY)) {
                startY += 1;
                drawGrid();
                requestAnimationFrame(() => moveDown(currentTetromino, startX, startY));
            } else {
                mergeTetromino(currentTetromino, startX, startY);
                clearRows();
                createTetromino();
            }
        }
        
        function moveLeft(currentTetromino, startX, startY) {
            const newStartX = startX - 1;
        
            if (!isCollision(currentTetromino, newStartX, startY)) {
                startX -= 1;
                drawGrid();
            }
        }
        
        function moveRight(currentTetromino, startX, startY) {
            const newStartX = startX + 1;
        
            if (!isCollision(currentTetromino, newStartX, startY)) {
                startX += 1;
                drawGrid();
            }
        }
        
        function createTetromino() {
            const tetrominoes = [
                [[1]],
                [[1, 1, 1, 1]],
                [[1, 0], [1, 0], [1, 1]],
                [[1, 0], [1, 1], [0, 1]],
                [[1, 1], [1, 1]],
                [[1, 1, 0], [0, 1, 1]]
            ];
        
            const randomIdx = Math.floor(Math.random() * tetrominoes.length);
            const currentTetromino = tetrominoes[randomIdx];
            const startX = Math.floor(columns / 2) - Math.floor(currentTetromino[0].length / 2);
            const startY = 0;
        
            if (isCollision(currentTetromino, startX, startY)) {
                alert('Game Over!');
                return;
            }
        
            moveDown(currentTetromino, startX, startY);
        }
        
        createGrid();
        createTetromino();
        
        document.addEventListener('keydown', (event) => {
            const currentTetromino = tetrominoes[tetrominoIndex];
        
            if (event.key === 'ArrowUp') {
                const rotatedTetromino = rotateTetromino(currentTetromino);
        
                if (!isCollision(rotatedTetromino, startX, startY)) {
                    currentTetromino = rotatedTetromino;
                }
            }
        
            if (event.key === 'ArrowLeft') {
                moveLeft(currentTetromino, startX, startY);
            }
        
            if (event.key === 'ArrowRight') {
                moveRight(currentTetromino, startX, startY);
            }
        });
    </script>
</body>
</html>
